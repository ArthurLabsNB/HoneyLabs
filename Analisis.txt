Organiza el monorepo
1.1. Crea workspace PNPM/Turbo con: packages/ui, packages/hooks, packages/sdk, packages/db, apps/web, apps/mobile.
1.2. Usa ESLint + Prettier + Vitest compartidos.

Capa de base de datos solo‐servidor
2.1. Paquete @honeylabs/db → schema.prisma + prisma-client.ts.
2.2. En package.json: "browser": { "./prisma-client.ts": "./noop.js" } para que Prisma nunca llegue al cliente.
2.3. Variables DATABASE_URL únicamente en el entorno backend.

API tipada
3.1. Implementa route handlers Next 14 (app/api/**/route.ts) o routers tRPC.
3.2. Allí se llama a db.*; usa Prisma Accelerate si es edge/serverless.
3.3. Protege cada endpoint con JWT; aplica Row-Level Security en PostgreSQL.

SDK cliente offline-first
4.1. Genera hooks (useInventario, useAlmacén, etc.) con tRPC/GraphQL Codegen.
4.2. Persiste queries y mutaciones con TanStack Query + Dexie (web) ↔ SQLite (Capacitor).
4.3. Implementa cola de mutaciones cifrada (txn_id, client_id, ts).

Sincronización y resolución de conflictos
5.1. Al volver online, POST /sync con lote de ops.
5.2. Backend: deduplica por txn_id; aplica última versión (updated_at) o merge-patch/CRDT.
5.3. Devuelve diff; frontend actualiza cache TanStack Query.
5.4. Propaga cambios en tiempo real vía WebSocket (LISTEN/NOTIFY).

PWA robusta (web)
6.1. Instala next-pwa; configura Workbox:
• UI → Stale-While-Revalidate
• Datos críticos → NetworkFirst
6.2. Activa Background Sync para cola cuando la pantalla esté cerrada.
6.3. Genera manifest, icons, theme_color.

Wrapper móvil (Android)
7.1. Opción completa: Capacitor 5
– npx cap init → cap add android → cap sync android.
– Plugins: SQLite, Push, Filesystem, Network.
7.2. Opción ultraligera: Trusted Web Activity + Bubblewrap.
7.3. Configura ProGuard + R8, firma con keystore prod.

Wrapper desktop opcional
8.1. Tauri (tauri build) para .msi / .dmg / .AppImage (< 20 MB).

Pipeline de build “on-demand” (botón Descargar App)
9.1. GitHub Action / EAS Build pasos:
• npm ci → npm run build (Next)
• cap sync android && cap build android
• Firma APK, sube a GitHub Release / S3 presignado.
9.2. Endpoint /api/build-mobile (Route Handler):
• Autentica admin → dispara repository_dispatch → devuelve run_id.
9.3. Frontend abre SSE/WS para progreso; muestra barra y ETA.

Página “App” en la web
10.1. Fetch /api/app → {version, url, sha256}.
10.2. Si build en curso: spinner y porcentaje.
10.3. Botón <a download> con SHA-256 visible para confianza.

Actualización continua (snapshot)
11.1. Cada merge a main: pruebas → prisma migrate deploy → genera nueva APK; nombre HoneyLabs-YYYYMMDDHH.apk.
11.2. Backend publica /version con número + enlace.
11.3. App al abrir: comprueba /version; si mayor, descarga en segundo plano (Capacitor Live Update o propia), verifica firma, reinicia.

Persistencia offline perfecta
12.1. Todas las escrituras primero a store local (Dexie/SQLite).
12.2. Marcadas con pending=true.
12.3. Éxito de sync ➜ marca pending=false; error retriable → re-queue.

Prevención de duplicados/pérdidas
13.1. Llave primaria compuesta (id, client_id).
13.2. Postgres ON CONFLICT DO NOTHING para idempotencia.
13.3. Soft-delete (deleted_at) en vez de DELETE físico.

Seguridad adicional
14.1. TLS 1.3 + certificate pinning móvil.
14.2. URLs de descarga presignadas válidas 15 min.
14.3. Ofusca JS/WASM con Terser; R8 full-mode.
14.4. Licencia propietaria + obfuscación cadena de texto.

Control de versiones de datos
15.1. Añade columna version incremental.
15.2. Durante merge, conserva mayor version.

QA automática
16.1. Vitest backend y frontend.
16.2. Playwright e2e para PWA.
16.3. Detox (Capacitor) para móvil.

Monitoreo y telemetry
17.1. Sentry (web + móvil).
17.2. Supabase Logflare o Grafana Loki para logs.
17.3. Postgres pg_stat_statements para detectar consultas lentas.

Auditoría del bundle
18.1. webpack-bundle-analyzer asegure cero @prisma/client/pg.
18.2. Alias cliente: resolve.alias["@honeylabs/db"] = false.

Registro de cambios (changelog)
19.1. Genera automáticamente con Conventional Commits (release-please).
19.2. Muestra notas en la app cuando hay actualización mayor.

Documentación interna
20.1. README por paquete.
20.2. Diagrama de flujo sync (Mermaid) en /docs.
